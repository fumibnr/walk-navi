<!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <title>リアルタイム車ナビ</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" /> <style> body, html { margin:0; padding:0; height:100%; } #map { width:100%; height:100%; } #controls { position:absolute; top:10px; left:10px; z-index:1000; background:white; padding:10px; border-radius:8px; } </style> </head> <body> <div id="controls"> 目的地: <input type="text" id="destination" placeholder="住所または座標" /> <button id="goBtn">経路表示</button> </div> <div id="map"></div> <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script> <script> let map = L.map('map').fitWorld(); let userMarker, routeLayer; // 現在地追従 if (navigator.geolocation) { navigator.geolocation.watchPosition(position => { const lat = position.coords.latitude; const lng = position.coords.longitude; if (!userMarker) { userMarker = L.marker([lat,lng]).addTo(map).bindPopup("現在地").openPopup(); map.setView([lat,lng], 16); } else { userMarker.setLatLng([lat,lng]); } // すでに目的地入力済みならルート再取得 if (routeLayer && document.getElementById('destination').value) { drawRoute(lat, lng, document.getElementById('destination').value); } }, err => alert("位置情報取得できませんでした")); } else { alert("Geolocationがサポートされていません"); } // OpenRouteService APIキー const ORS_API_KEY = "YOUR_API_KEY_HERE"; // 車ルート取得＋描画 async function drawRoute(startLat, startLng, destination) { try { // 住所→座標変換（Nominatim） const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination)}`); const geoData = await geoRes.json(); if (!geoData[0]) { alert("目的地が見つかりません"); return; } const destLat = geoData[0].lat; const destLng = geoData[0].lon; // OpenRouteService driving-car API const routeRes = await fetch("https://api.openrouteservice.org/v2/directions/driving-car/geojson", { method: "POST", headers: { "Authorization": ORS_API_KEY, "Content-Type": "application/json" }, body: JSON.stringify({ coordinates: [[startLng, startLat], [destLng, destLat]] }) }); const routeData = await routeRes.json(); if (routeLayer) map.removeLayer(routeLayer); routeLayer = L.geoJSON(routeData).addTo(map); } catch (e) { console.error(e); alert("ルート取得に失敗しました"); } } // ボタンでルート document.getElementById('goBtn').addEventListener('click', () => { if (userMarker) { const latlng = userMarker.getLatLng(); const dest = document.getElementById('destination').value; drawRoute(latlng.lat, latlng.lng, dest); } else { alert("現在地取得中…"); } }); </script> </body> </html>
